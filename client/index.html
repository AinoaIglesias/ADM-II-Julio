<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Visualizador de Datos</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; }
    h2 { margin-top: 2rem; }
    label { display: block; margin-top: 1rem; }
    select, input[type=file], button { margin-top: 0.5rem; }
    iframe { width: 100%; height: 600px; border: none; margin-top: 2rem; }
  </style>
</head>
<body>
  <h1>Framework de Análisis de Datos</h1>

  <h2>1. Cargar CSV</h2>
  <input type="file" id="csvFile">
  <button onclick="uploadFile()">Subir y Analizar</button>

  <pre id="datasetInfo"></pre>

  <h2>2. Visualizar Datos</h2>
  <label for="chartType">Tipo de gráfica:</label>
  <select id="chartType">
    <option value="bar">Barras</option>
    <option value="line">Líneas</option>
    <option value="histogram">Histograma</option>
    <option value="scatter">Dispersión</option>
  </select>

  <label for="xAxis">Columna X:</label>
  <select id="xAxis"></select>

  <label for="yAxis">Columna Y:</label>
  <select id="yAxis"></select>

  <label for="groupBy">Agrupar por (opcional):</label>
  <select id="groupBy">
    <option value="">(Ninguno)</option>
  </select>

  <button onclick="generateChart()">Generar gráfica</button>

  <iframe id="chartFrame"></iframe>

  <script>
    let columns = [];

    async function uploadFile() {
      const input = document.getElementById('csvFile');
      const file = input.files[0];
      const formData = new FormData();
      formData.append('file', file);

      const res = await fetch('/upload', { method: 'POST', body: formData });
      const data = await res.json();
      document.getElementById('datasetInfo').textContent = JSON.stringify(data, null, 2);

      columns = data.columns;
      fillSelects(columns);
    }

    function fillSelects(cols) {
      const selects = ['xAxis', 'yAxis', 'groupBy'];
      for (let id of selects) {
        const sel = document.getElementById(id);
        sel.innerHTML = id === 'groupBy' ? '<option value="">(Ninguno)</option>' : '';
        cols.forEach(col => {
          const opt = document.createElement('option');
          opt.value = col;
          opt.textContent = col;
          sel.appendChild(opt);
        });
      }
    }

    async function generateChart() {
      const chartType = document.getElementById('chartType').value;
      const x = document.getElementById('xAxis').value;
      const y = document.getElementById('yAxis').value;
      const group = document.getElementById('groupBy').value || null;

      const res = await fetch('/plot', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ type: chartType, x, y, group })
      });

      if (res.ok) {
        document.getElementById('chartFrame').src = '/output/plot.html';
      }
    }
  </script>
</body>
</html>
